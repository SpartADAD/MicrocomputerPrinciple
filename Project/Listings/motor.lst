C51 COMPILER V9.59.0.0   MOTOR                                                             12/09/2018 18:01:07 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN .\Objects\motor.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\motor.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardW
                    -are;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\motor.lst) TABS(2) OBJECT(.\Objects\motor.obj)

line level    source

   1          /****************************motor.c********************************/
   2          #include "motor.h"
   3          #include "gpio.h"
   4          #include "STC15F2K60S2.h"
   5          #include "math.h"
   6          #include "main.h"
   7          #include "delay.h"
   8          #include "82c55.h"
   9          
  10          #define CLOCK_WISE            1
  11          #define COUNTER_CLOCK_WISE    0
  12          
  13          void MotorControl(void)
  14          {
  15   1        uint32_t xdata vel = 0;
  16   1        vel=10+((MOTOR_VEL_HIGH<<1)|MOTOR_VEL_LOW)*30;
  17   1        
  18   1        if(MOTOR_SWITCH)
  19   1        {
  20   2          if(MOTOR_ROTATE_DIRECTION)
  21   2          {
  22   3            MotorRotate(CLOCK_WISE,vel);
  23   3          }
  24   2          else
  25   2          {
  26   3            MotorRotate(COUNTER_CLOCK_WISE,vel);  
  27   3          }
  28   2        }
  29   1      }
  30          #define SEQUENCE    4
  31          void MotorRotate(uint8_t rotateDirection,uint32_t rotateVel)
  32          {
  33   1        uint8_t xdata sequence=0;
  34   1        uint8_t xdata myCode=0;
  35   1        if(rotateDirection)
  36   1        {
  37   2          for(sequence = 0; sequence<SEQUENCE;sequence++)
  38   2          {
  39   3            myCode=pow(2,sequence);
  40   3            
  41   3            P1=myCode;
  42   3            DelayMs(rotateVel);
  43   3            
  44   3            myCode=myCode|(myCode<<1);
  45   3            if(myCode>0x0f)
  46   3            {
  47   4              myCode=0x09;
  48   4            }
  49   3            
  50   3            P1=myCode;
  51   3            DelayMs(rotateVel);
  52   3          }
  53   2        }
  54   1        else
C51 COMPILER V9.59.0.0   MOTOR                                                             12/09/2018 18:01:07 PAGE 2   

  55   1        {
  56   2          for(sequence = SEQUENCE-1; sequence>0;sequence--)
  57   2          {
  58   3            myCode=pow(2,sequence);
  59   3            
  60   3            P1=myCode;
  61   3            DelayMs(rotateVel);
  62   3            
  63   3            myCode=myCode|(myCode>>1);
  64   3            if(myCode==0x01)
  65   3            {
  66   4              myCode=0x09;
  67   4            }
  68   3            
  69   3            P1=myCode;
  70   3            DelayMs(rotateVel);
  71   3          }
  72   2        }
  73   1      
  74   1      }
  75          #define MAIN_PERIOD_MS    5
  76          #define MOTOR_VEL_HIGH_C55 PORTx_ReadBits(PORT_B,PORT_PIN_1)
  77          #define MOTOR_VEL_LOW_C55 PORTx_ReadBits(PORT_B,PORT_PIN_0)
  78          
  79          void MotorRotateByTIM(void)
  80          {
  81   1        uint8_t xdata myCode[8]={0x01,0x03,0x02,0x06,0x04,0x0C,0x08,0x09};
  82   1        uint16_t xdata timeControl=400;
  83   1        uint16_t xdata rotateVel=1+((MOTOR_VEL_HIGH_C55<<1)|MOTOR_VEL_LOW_C55);
  84   1        static  uint8_t xdata rotateDirection=CLOCK_WISE;
  85   1        static uint32_t xdata runTime=0;
  86   1        static uint16_t xdata rotateVelTime=0;
  87   1        static char xdata runStep =0;
  88   1        runTime++;
  89   1        rotateVelTime++;
  90   1        
  91   1        if(runTime<=timeControl)
  92   1        {
  93   2          rotateDirection = CLOCK_WISE;
  94   2        }
  95   1        else if(runTime>timeControl&&runTime<=2*timeControl)
  96   1        {
  97   2          rotateDirection = COUNTER_CLOCK_WISE;
  98   2        }
  99   1        else if(runTime>2*timeControl)
 100   1        {
 101   2          runTime=0;
 102   2          rotateDirection = CLOCK_WISE;
 103   2        }
 104   1        
 105   1        if(rotateVelTime>=rotateVel)
 106   1        {
 107   2          rotateVelTime = 0;
 108   2          if(rotateDirection)
 109   2          {
 110   3            runStep++;
 111   3            if(runStep>=8)
 112   3              runStep=0;
 113   3          }
 114   2          else
 115   2          {
 116   3            runStep--;
C51 COMPILER V9.59.0.0   MOTOR                                                             12/09/2018 18:01:07 PAGE 3   

 117   3            if(runStep<0)
 118   3              runStep=7;
 119   3          }
 120   2        }
 121   1        
 122   1        P8255_A = myCode[runStep];
 123   1      }
 124          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    624    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =      6      16
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
