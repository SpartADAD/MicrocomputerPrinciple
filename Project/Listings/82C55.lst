C51 COMPILER V9.59.0.0   82C55                                                             11/27/2018 23:04:45 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE 82C55
OBJECT MODULE PLACED IN .\Objects\82C55.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\82C55.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardW
                    -are;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\82C55.lst) TABS(2) OBJECT(.\Objects\82C55.obj)

line level    source

   1          /****************************82C55.c***********************/
   2          #include "82C55.h"
   3          #include "delay.h"
   4          #include "stdio.h"
   5          #include "main.h"
   6          
   7          
   8          uint8_t xdata P8255_CTL _at_ 0xf803;
   9          uint8_t xdata P8255_A _at_ 0xf800;
  10          uint8_t xdata P8255_B _at_ 0xf801;
  11          uint8_t xdata P8255_C _at_ 0xf802;
  12          
  13          #define A0    P0^0  
  14          #define A1    P0^1  
  15          
  16          void C55_Init(uint8_t group,uint8_t groupWorkMode,uint8_t Port,uint8_t PortInOrOut)
  17          {
  18   1        P8255_CTL|=0x80;
  19   1        switch(group)
  20   1        {
  21   2          case GROUP_A:
  22   2            groupWorkMode&=0x10;
  23   2            P8255_CTL|=(groupWorkMode<<5);
  24   2          break;
  25   2          
  26   2          case GROUP_B:
  27   2            groupWorkMode&=0x01;
  28   2            P8255_CTL|=(groupWorkMode<<2);
  29   2          break;
  30   2          
  31   2          default:
  32   2          break;
  33   2        }
  34   1        
  35   1        switch(Port)
  36   1        {
  37   2          case PORT_A:
  38   2            P8255_CTL|=(PortInOrOut<<4);
  39   2          break;
  40   2          
  41   2          case PORT_B:
  42   2            P8255_CTL|=(PortInOrOut<<2);
  43   2          break;
  44   2          
  45   2          case PORT_C_HIGH:
  46   2            P8255_CTL|=(PortInOrOut<<3);
  47   2          break;
  48   2          
  49   2          case PORT_C_LOW:
  50   2            P8255_CTL|=(PortInOrOut<<1);
  51   2          break;
  52   2          
  53   2          default:
  54   2          break;
C51 COMPILER V9.59.0.0   82C55                                                             11/27/2018 23:04:45 PAGE 2   

  55   2        }
  56   1      } 
  57          
  58          
  59          
  60          void C55_SendByte(uint8_t Port,uint8_t dataSend)
  61          {
  62   1        switch(Port)
  63   1        {
  64   2          case PORT_A:
  65   2            P8255_A = dataSend;
  66   2          break;
  67   2          
  68   2          case PORT_B:
  69   2            P8255_B = dataSend;
  70   2          break;
  71   2          
  72   2          case PORT_C:
  73   2            P8255_C = dataSend;
  74   2          break;
  75   2          
  76   2          default:
  77   2          break;
  78   2        }
  79   1      }
  80          
  81          uint8_t C55_ReceiveByte(uint8_t Port)
  82          {
  83   1        uint8_t dataReceive= 0;
  84   1        switch(Port)
  85   1        {
  86   2          case PORT_A:
  87   2            dataReceive = P8255_A;
  88   2          break;
  89   2          
  90   2          case PORT_B:
  91   2            dataReceive = P8255_B;
  92   2          break;
  93   2          
  94   2          case PORT_C:
  95   2            dataReceive = P8255_C;
  96   2          break;
  97   2          
  98   2          default:
  99   2          break;
 100   2        }
 101   1        
 102   1        return dataReceive;
 103   1      }
 104            
 105          /**
 106            * @brief  GPIO口某位置位函数
 107            * @param  GPIOx 某一GPIO口  
 108            * @param  GPIO_Pin_x  某一GPIO口的某一位
 109            * @retval void
 110            */
 111          void PORTx_SetBits(unsigned char PORTx,unsigned char PORT_Pin_x)
 112          {
 113   1        switch(PORTx)
 114   1        {
 115   2          case PORT_A:
 116   2            P8255_A |=(int)pow(2,PORT_Pin_x);
C51 COMPILER V9.59.0.0   82C55                                                             11/27/2018 23:04:45 PAGE 3   

 117   2          break;
 118   2          
 119   2          case PORT_B:
 120   2            P8255_B |=(int)pow(2,PORT_Pin_x);
 121   2          break;
 122   2          
 123   2          case PORT_C:
 124   2            P8255_C |=(int)pow(2,PORT_Pin_x);
 125   2          break;
 126   2          
 127   2          
 128   2          default:
 129   2            
 130   2          break;
 131   2        }
 132   1          
 133   1      }
 134          /**
 135            * @brief  GPIO口某位复位函数
 136            * @param  GPIOx 某一GPIO口  
 137            * @param  GPIO_Pin_x  某一GPIO口的某一位
 138            * @retval void
 139            */
 140          void PORTx_ResetBits(unsigned char PORTx,unsigned char PORT_Pin_x)
 141          {
 142   1        switch(PORTx)
 143   1        {
 144   2          case PORT_A:
 145   2            P8255_A &=(~(int)pow(2,PORT_Pin_x));
 146   2          break;
 147   2          
 148   2          case PORT_B:
 149   2            P8255_B &=(~(int)pow(2,PORT_Pin_x));
 150   2          break;
 151   2          
 152   2          case PORT_C:
 153   2            P8255_C &=(~(int)pow(2,PORT_Pin_x));
 154   2          break;
 155   2          
 156   2          default:
 157   2          break;
 158   2        }
 159   1      }
 160          
 161          /**
 162            * @brief  GPIO口某位读取当前状态函数
 163            * @param  GPIOx 某一GPIO口  
 164            * @param  GPIO_Pin_x  某一GPIO口的某一位
 165            * @retval 某一GPIO口当前GPIO的状态
 166            */
 167          uint8_t PORTx_ReadBits(uint8_t PORTx, unsigned char Port_Pin_x)
 168          {
 169   1        unsigned char returnStatus=0;
 170   1        unsigned char Port_Pin_x_BIN=(int)pow(2,Port_Pin_x);
 171   1        
 172   1        switch(PORTx)
 173   1        {
 174   2          case PORT_A:
 175   2      //      P8255_A|=Port_Pin_x_BIN;
 176   2            returnStatus = P8255_A & Port_Pin_x_BIN;
 177   2          break;
 178   2          
C51 COMPILER V9.59.0.0   82C55                                                             11/27/2018 23:04:45 PAGE 4   

 179   2          case PORT_B:
 180   2      //      P8255_B|=Port_Pin_x_BIN;
 181   2            returnStatus = P8255_B & Port_Pin_x_BIN;
 182   2          break;
 183   2          
 184   2          case PORT_C:
 185   2      //      P8255_C|=Port_Pin_x_BIN;
 186   2            returnStatus = P8255_C & Port_Pin_x_BIN;
 187   2          break;
 188   2          
 189   2          
 190   2          default:
 191   2          break;
 192   2        }
 193   1        
 194   1        return (returnStatus>>Port_Pin_x_BIN);
 195   1      }
 196          
 197          void KeyReadBy82C55(void)
 198          {
 199   1        uint8_t keyStatus =0;
 200   1        
 201   1        keyStatus = P8255_A;
 202   1      
 203   1        P8255_B=(~keyStatus);
 204   1      
 205   1      }
 206          #define STB_STATUS  PORTx_ReadBits(PORT_C,PORT_PIN_4)
 207          #define STB_RESET   PORTx_ResetBits(PORT_C,PORT_PIN_4)
 208          #define STB_SET     PORTx_SetBits(PORT_C,PORT_PIN_4)
 209          
 210          #define BUSY_STATUS PORTx_ReadBits(PORT_C,PORT_PIN_0)
 211          #define BUSY_RESET  PORTx_ResetBits(PORT_C,PORT_PIN_0)
 212          #define BUSY_SET    PORTx_SetBits(PORT_C,PORT_PIN_0)
 213          
 214          void AToB(void)
 215          {
 216   1        uint8_t sendArray[1]={'H'};
 217   1      
 218   1        STB_SET;
 219   1        C55_SendByte(PORT_A,sendArray[1]);
 220   1        STB_RESET;
 221   1        while(BUSY_STATUS);
 222   1      }
 223          
 224          void BReceive(void)
 225          {
 226   1        uint8_t receiveFromA=0;
 227   1        while(STB_STATUS);
 228   1        BUSY_SET;
 229   1        receiveFromA=C55_ReceiveByte();
*** WARNING C209 IN LINE 229 OF USERS\HardWare\82C55.c: '_C55_ReceiveByte': too few actual parameters
 230   1        BUSY_RESET;
 231   1      }
 232          
 233          void SendAndReceive(void)
 234          {
 235   1        uint8_t receiveFromA=0;
 236   1        
 237   1        C55_Init();
*** WARNING C209 IN LINE 237 OF USERS\HardWare\82C55.c: '_C55_Init': too few actual parameters
 238   1        
C51 COMPILER V9.59.0.0   82C55                                                             11/27/2018 23:04:45 PAGE 5   

 239   1        STB_SET;
 240   1        C55_SendByte(PORT_A,sendArray[1]);
*** ERROR C202 IN LINE 240 OF USERS\HardWare\82C55.c: 'sendArray': undefined identifier
 241   1        
 242   1        STB_RESET;
 243   1        
 244   1        
 245   1        receiveFromA=C55_ReceiveByte();
 246   1        BUSY_RESET;
 247   1      
 248   1      
 249   1      
 250   1      }
 251          

C51 COMPILATION COMPLETE.  2 WARNING(S),  1 ERROR(S)
