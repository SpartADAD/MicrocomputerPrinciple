C51 COMPILER V9.59.0.0   GPIO                                                              11/08/2018 22:07:33 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE GPIO
OBJECT MODULE PLACED IN .\Objects\gpio.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\gpio.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardWa
                    -re;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\gpio.lst) TABS(2) OBJECT(.\Objects\gpio.obj)

line level    source

   1          /****************************gpio.c********************************/
   2          
   3          #include "gpio.h"
   4          #include "STC15F2K60S2.h"
   5          #include "math.h"
   6          //const enum
   7          //{
   8          //  GPIOP0 = 0,
   9          //  GPIOP1,
  10          //  GPIOP2,
  11          //  GPIOP3,
  12          //  GPIOP4
  13          //}GPIOTypeDef_t;
  14          
  15          void GPIOx_SetBits(unsigned char GPIOx,unsigned char GPIO_Pin_x)
  16          {
  17   1        switch(GPIOx)
  18   1        {
  19   2          case GPIOP0:
  20   2            P0 |=(int)pow(2,GPIO_Pin_x);
  21   2          break;
  22   2          
  23   2          case GPIOP1:
  24   2            P1 |=(int)pow(2,GPIO_Pin_x);
  25   2          break;
  26   2          
  27   2          case GPIOP2:
  28   2            P2 |=(int)pow(2,GPIO_Pin_x);
  29   2          break;
  30   2          
  31   2          case GPIOP3:
  32   2            P3 |=(int)pow(2,GPIO_Pin_x);
  33   2          break;
  34   2          
  35   2          case GPIOP4:
  36   2            P4 |=(int)pow(2,GPIO_Pin_x);
  37   2          break;
  38   2          
  39   2          default:
  40   2            
  41   2          break;
  42   2        }
  43   1          
  44   1      }
  45          
  46          void GPIOx_ResetBits(unsigned char GPIOx,unsigned char GPIO_Pin_x)
  47          {
  48   1        switch(GPIOx)
  49   1        {
  50   2          case GPIOP0:
  51   2            P0 &=(~(int)pow(2,GPIO_Pin_x));
  52   2          break;
  53   2          
  54   2          case GPIOP1:
C51 COMPILER V9.59.0.0   GPIO                                                              11/08/2018 22:07:33 PAGE 2   

  55   2            P1 &=(~(int)pow(2,GPIO_Pin_x));
  56   2          break;
  57   2          
  58   2          case GPIOP2:
  59   2            P2 &=(~(int)pow(2,GPIO_Pin_x));
  60   2          break;
  61   2          
  62   2          case GPIOP3:
  63   2            P3 &=(~(int)pow(2,GPIO_Pin_x));
  64   2          break;
  65   2          
  66   2          case GPIOP4:
  67   2            P4 &=(~(int)pow(2,GPIO_Pin_x));
  68   2          break;
  69   2          
  70   2          default:
  71   2            
  72   2          break;
  73   2        }
  74   1      
  75   1      }
  76          
  77          unsigned char GPIOx_ReadBits(unsigned char GPIOx, unsigned char GPIO_Pin_x)
  78          {
  79   1        unsigned char returnStatus=0;
  80   1        unsigned char GPIO_Pin_x_BIN=(int)pow(2,GPIO_Pin_x);
  81   1        
  82   1        switch(GPIOx)
  83   1        {
  84   2          case GPIOP0:
  85   2            P0|=GPIO_Pin_x_BIN;
  86   2            returnStatus = P0 & GPIO_Pin_x_BIN;
  87   2          break;
  88   2          
  89   2          case GPIOP1:
  90   2            P1|=GPIO_Pin_x_BIN;
  91   2            returnStatus = P1 & GPIO_Pin_x_BIN;
  92   2          break;
  93   2          
  94   2          case GPIOP2:
  95   2            P2|=GPIO_Pin_x_BIN;
  96   2            returnStatus = P2 & GPIO_Pin_x_BIN;
  97   2          break;
  98   2          
  99   2          case GPIOP3:
 100   2            P3|=GPIO_Pin_x_BIN;
 101   2            returnStatus = P3 & GPIO_Pin_x_BIN;
 102   2          break;
 103   2          
 104   2          default:
 105   2          break;
 106   2        }
 107   1        
 108   1        return (returnStatus>>GPIO_Pin_x);
 109   1      }
 110          
 111          #define GET_BIT_NUMBER    4
 112          void KeyControl(void)
 113          {
 114   1        unsigned char HighFour=0;
 115   1        
 116   1        /*输入端置位操作*/
C51 COMPILER V9.59.0.0   GPIO                                                              11/08/2018 22:07:33 PAGE 3   

 117   1        P1|=0xf0;
 118   1        
 119   1        HighFour=(P1 & 0xf0); 
 120   1        P1= (~(HighFour>>4));
 121   1      
 122   1      }
 123          void ShowKeyValue(void)
 124          {
 125   1        unsigned char HighFour=0; 
 126   1        unsigned char codeMy=0;
 127   1        unsigned char i=0;
 128   1        
 129   1        P1|=0xf0;
 130   1        HighFour= ((P1 & 0xf0)>>4); 
 131   1        /*输入端置位操作*/
 132   1        
 133   1        for(i=0;i<4;i++)
 134   1        {
 135   2          codeMy+=((HighFour&((int)pow(2,i)))>>i)*(i+1);
 136   2        }
 137   1        GPIOx_SetBits(1,3);
 138   1      //  if(HighFour==0x08)
 139   1      //  {
 140   1      //    GPIOx_ResetBits(1,0);
 141   1      //    GPIOx_ResetBits(1,1);
 142   1      //  }
 143   1      //  else if(HighFour==0x04)
 144   1      //  {
 145   1      //    GPIOx_SetBits(1,0);
 146   1      //    GPIOx_ResetBits(1,1);
 147   1      //  }else if(HighFour==0x02)
 148   1      //  {
 149   1      //    GPIOx_ResetBits(1,0);
 150   1      //    GPIOx_SetBits(1,1);
 151   1      //  }else if (HighFour==0x01)
 152   1      //  {
 153   1      //    GPIOx_SetBits(1,0);
 154   1      //    GPIOx_SetBits(1,1);
 155   1      //  }else
 156   1      //  {
 157   1      //    GPIOx_SetBits(1,0);
 158   1      //    GPIOx_SetBits(1,1);
 159   1      //  }
 160   1        P1=~codeMy;
 161   1      
 162   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    638    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
