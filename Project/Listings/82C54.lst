C51 COMPILER V9.59.0.0   82C54                                                             12/28/2018 19:29:25 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE 82C54
OBJECT MODULE PLACED IN .\Objects\82C54.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\82C54.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardW
                    -are;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\82C54.lst) TABS(2) OBJECT(.\Objects\82C54.obj)

line level    source

   1          /****************************82C54.c***********************/
   2          #include "82C54.h"
   3          #include "main.h"
   4          #include "STC15F2K60S2.h"
   5          #include "HD7279.h"
   6          
   7          uint8_t xdata P8254_CTL _at_ 0xF903;
   8          uint8_t xdata P8254_0 _at_ 0xF900;
   9          uint8_t xdata P8254_1 _at_ 0xF901;
  10          uint8_t xdata P8254_2 _at_ 0xF902;
  11          
  12          uint8_t  P374       _at_ 0xFa00; 
  13          /** 
  14            * @brief  åˆ†åˆ«å¯¹å‡ ä¸ªå®éªŒæ ¹æ®é¢„ç¼–è¯‘å®è¿›è¡Œåˆå§‹åŒ–  
  15            * @param  void
  16            * @retval none
  17            */
  18          void My82C54Init(void)
  19          {
  20   1        /*è®¾ç½®åˆ†é¢‘*/
  21   1        CLK_DIV=0x40;
  22   1        /*å®éªŒ1åˆå§‹åŒ–*/
  23   1        #if C54_EXPERIMENT == C54_EXPERIMENT_1
  24   1        /*åˆå§‹åŒ–è®¡æ•°å™¨0ä¸ºåˆ†é¢‘æ¨¡å¼ï¼Œè£…è½½å€¼5ï¼ˆå‡½æ•°å†…éƒ¨å‡å»1ï¼‰ï¼Œä¸ºäºŒè¿›åˆ¶è®¡æ•°*/
  25   1            Init_82C54(COUNT_0, FREQUENCY_DIVISION_MODE,5,BINARY_COUNT);
  26   1        /*å®éªŒ2åˆå§‹åŒ–*/
  27   1        #elif C54_EXPERIMENT == C54_EXPERIMENT_2
                /*åˆå§‹åŒ–è®¡æ•°å™¨1ï¼Œ2ä¸ºæ–¹æ³¢å‘ç”Ÿæ¨¡å¼ä¸¤è€…çº§è”ï¼Œè£…è½½å€¼2000ï¼Œä¸ºäºŒè¿›åˆ¶è®¡æ•°*/
                    Init_82C54(COUNT_1, SQUARE_WAVE_MODE,2000,BINARY_COUNT);
                    Init_82C54(COUNT_2, SQUARE_WAVE_MODE,2000,BINARY_COUNT);
                /*å®éªŒ3åˆå§‹åŒ–*/
                #elif C54_EXPERIMENT == C54_EXPERIMENT_3
                    /*ç­‰å¼€å…³çŠ¶æ€å˜åŒ–æ‰è¿›è¡Œåˆå§‹åŒ–*/
                #endif
  35   1      
  36   1      
  37   1      }
  38          /** 
  39            * @brief  C54åˆå§‹åŒ–  
  40            * @param  count_x é€‰æ‹©æŸä¸€ä¸ªè®¡æ•°å™¨  counterMode é€‰æ‹©è®¡æ•°æ¨¡å¼ countTime è®¡æ•°æ—¶é—´ codeMod
             -eè®¡æ•°æ–¹å¼ BCDæˆ–è€…äºŒè¿›åˆ¶
  41            * @retval none
  42            */
  43          void Init_82C54(uint8_t count_x, uint8_t counterMode, uint16_t countTime,uint8_t codeMode)
  44          {
  45   1        uint8_t lowValue=0;
  46   1        uint8_t highValue=0;
  47   1        uint8_t  initCode=0;
  48   1        
  49   1        count_x&=0x03;
  50   1        counterMode&=0x07;
  51   1        initCode = ((count_x << 6) | (counterMode << 1)) | 0X30 | codeMode;
  52   1        //å…ˆå†™ä½ä½ï¼Œå†å†™é«˜ä½ï¼Œé€‰æ‹©äºŒè¿›åˆ¶è®¡æ•°
  53   1        P8254_CTL = initCode;   
C51 COMPILER V9.59.0.0   82C54                                                             12/28/2018 19:29:25 PAGE 2   

  54   1        //å½“ä¸ºå·¥ä½œæ–¹å¼å³æ–¹å¼0æ—¶ï¼Œè®¡æ•°å€¼éœ€è¦å‡1
  55   1        if(counterMode == INTERRUPT_MODE)     
  56   1        {
  57   2          countTime -= 1;
  58   2        }
  59   1        
  60   1        lowValue = (countTime & 0XFF);    //å–ä½å­—èŠ‚æ•°
  61   1        highValue = (countTime >> 8) & 0XFF;    //å–é«˜å­—èŠ‚æ•°
  62   1        switch(count_x)
  63   1        {
  64   2          case COUNT_0 :        //å¯¹åº”è®¡æ•°å™¨0
  65   2            P8254_0 = lowValue;
  66   2            P8254_0 = highValue;
  67   2            break;
  68   2          
  69   2          case COUNT_1 :        //å¯¹åº”è®¡æ•°å™¨1
  70   2            P8254_1= lowValue;
  71   2            P8254_1 = highValue;
  72   2            break;
  73   2          
  74   2          case COUNT_2 :        //å¯¹åº”è®¡æ•°å™¨2
  75   2            P8254_2= lowValue;
  76   2            P8254_2 = highValue;
  77   2            break;
  78   2          
  79   2          default:
  80   2            
  81   2          break;
  82   2        }
  83   1      }
  84          /** 
  85            * @brief  å®éªŒ1è¿›è¡Œledæµæ°´ç¯ å’Œè·‘é©¬ç¯åˆ‡æ¢ rightShiftæ§åˆ¶æµæ°´ç¯ timeDelayæ§åˆ¶å»¶æ—¶æ—¶
             -é—´
  86            * @param  void
  87            * @retval none
  88            */
  89          void EXInterruptLed(void)
  90          {
  91   1        static uint16_t timeDelay=0;
  92   1        static uint8_t rightShift=0x01;
  93   1        timeDelay++;
  94   1        if(gParam.c55LedMode==0)
  95   1        {
  96   2          if(timeDelay<=100)
  97   2          {
  98   3            P374=0xf0;
  99   3          }else if(timeDelay>100&&timeDelay<200)
 100   2          {
 101   3            P374=0x0f;
 102   3          }else
 103   2          {
 104   3            timeDelay=0;
 105   3          }
 106   2        }
 107   1        else if(gParam.c55LedMode==1)
 108   1        {
 109   2          
 110   2          if(timeDelay>=200)
 111   2          {
 112   3            timeDelay=0;
 113   3            rightShift=(rightShift<<1);
 114   3            if(rightShift==0)
C51 COMPILER V9.59.0.0   82C54                                                             12/28/2018 19:29:25 PAGE 3   

 115   3            {
 116   4              rightShift=0x01;
 117   4            }
 118   3            P374=~rightShift;
 119   3          }
 120   2        }
 121   1      }
 122          /*å®šä¹‰å¼€å…³è¾“å…¥å®å®šä¹‰*/
 123          #define KEY_VALUE (P1&0x03)
 124          /** 
 125            * @brief  å®éªŒ3ï¼Œåˆ¤æ–­ä¸Šä¸€æ¬¡å’Œè¿™ä¸€æ¬¡è¯»å‡ºæ¥å¼€å…³çš„å€¼ï¼Œè‹¥ç›¸åŒçš„è¯ï¼Œåˆ™ç›´æ¥è¿”å›ï
             -¼Œè‹¥ä¸åŒçš„è¯å¯¹82C54
 126          è¿›è¡Œé‡æ–°åˆå§‹åŒ–ï¼ŒåŒæ—¶è®°ä½è¿™ä¸€æ¬¡çš„å¼€å…³å€¼,é€šè¿‡æ•°ç ç®¡ç›´æ¥æ˜¾ç¤ºå½“å‰çš„é¢‘ç‡
 127            * @param  void
 128            * @retval none
 129            */
 130          void DiffFangBo(void)
 131          {
 132   1        static  xdata lastValue = 0;
 133   1        uint8_t key = KEY_VALUE;
 134   1        uint16_t xdata countTime1=P8254_0;
 135   1        
 136   1        if(lastValue==key)
 137   1        { 
 138   2          return;
 139   2        }
 140   1        
 141   1        if(KEY_VALUE==0)
 142   1        {
 143   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,10,BINARY_COUNT);
 144   2          HD7279ShowInt(200000);
 145   2        }
 146   1        else if(KEY_VALUE==1)
 147   1        {
 148   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,100,BINARY_COUNT);
 149   2          HD7279ShowInt(20000);
 150   2        }
 151   1        else if(KEY_VALUE==2)
 152   1        {
 153   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,1000,BINARY_COUNT);
 154   2          HD7279ShowInt(2000);
 155   2        }
 156   1        else if(KEY_VALUE==3)
 157   1        {
 158   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,10000,BINARY_COUNT);
 159   2          HD7279ShowInt(200);
 160   2        }
 161   1        lastValue = key;
 162   1      }
 163          /** 
 164            * @brief  é€šè¿‡é¢„ç¼–è¯‘å®è¿›è¡Œä¸‹è½½
 165            * @param  void
 166            * @retval none
 167            */
 168          void MyExperiment82C54(void)
 169          {
 170   1        #if C54_EXPERIMENT == C54_EXPERIMENT_1
 171   1           EXInterruptLed();
 172   1        #elif C54_EXPERIMENT == C54_EXPERIMENT_2
                
                #elif C54_EXPERIMENT == C54_EXPERIMENT_3
                    DiffFangBo();
C51 COMPILER V9.59.0.0   82C54                                                             12/28/2018 19:29:25 PAGE 4   

                #endif
 177   1      
 178   1      
 179   1      
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    405    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
