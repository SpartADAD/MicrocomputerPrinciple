C51 COMPILER V9.59.0.0   82C54                                                             12/27/2018 21:24:49 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE 82C54
OBJECT MODULE PLACED IN .\Objects\82C54.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\82C54.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardW
                    -are;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\82C54.lst) TABS(2) OBJECT(.\Objects\82C54.obj)

line level    source

   1          /****************************82C55.c***********************/
   2          #include "82C54.h"
   3          #include "main.h"
   4          #include "STC15F2K60S2.h"
   5          #include "HD7279.h"
   6          
   7          uint8_t xdata P8254_CTL _at_ 0xF903;
   8          uint8_t xdata P8254_0 _at_ 0xF900;
   9          uint8_t xdata P8254_1 _at_ 0xF901;
  10          uint8_t xdata P8254_2 _at_ 0xF902;
  11          
  12          uint8_t  P374       _at_ 0xFa00; 
  13          /** 
  14            * @brief  åˆ†åˆ«å¯¹å‡ ä¸ªå®éªŒæ ¹æ®é¢„ç¼–è¯‘å®è¿›è¡Œåˆå§‹åŒ–  
  15            * @param  void
  16            * @retval none
  17            */
  18          void My82C54Init(void)
  19          {
  20   1        /*è®¾ç½®åˆ†é¢‘*/
  21   1        CLK_DIV=0x40;
  22   1        /*å®éªŒ1åˆå§‹åŒ–*/
  23   1        #if C54_EXPERIMENT == C54_EXPERIMENT_1
  24   1            Init_82C54(COUNT_0, FREQUENCY_DIVISION_MODE,5,BINARY_COUNT);
  25   1        /*å®éªŒ2åˆå§‹åŒ–*/
  26   1        #elif C54_EXPERIMENT == C54_EXPERIMENT_2
                    /**/
                    Init_82C54(COUNT_1, SQUARE_WAVE_MODE,2000,BINARY_COUNT);
                    Init_82C54(COUNT_2, SQUARE_WAVE_MODE,2000,BINARY_COUNT);
                /*å®éªŒ3åˆå§‹åŒ–*/
                #elif C54_EXPERIMENT == C54_EXPERIMENT_3
                    
                #endif
  34   1      
  35   1      
  36   1      }
  37          /** 
  38            * @brief  C54åˆå§‹åŒ–  
  39            * @param  count_x é€‰æ‹©æŸä¸€ä¸ªè®¡æ•°å™¨  counterMode é€‰æ‹©è®¡æ•°æ¨¡å¼ countTime è®¡æ•°æ—¶é—´ codeMod
             -eæŠ€æœ¯æ–¹å¼ BCDæˆ–è€…äºŒè¿›åˆ¶
  40            * @retval none
  41            */
  42          void Init_82C54(uint8_t count_x, uint8_t counterMode, uint16_t countTime,uint8_t codeMode)
  43          {
  44   1        uint8_t lowValue=0;
  45   1        uint8_t highValue=0;
  46   1        uint8_t  initCode=0;
  47   1        
  48   1        count_x&=0x03;
  49   1        counterMode&=0x07;
  50   1        initCode = ((count_x << 6) | (counterMode << 1)) | 0X30 | codeMode;
  51   1        //å…ˆå†™ä½ä½ï¼Œå†å†™é«˜ä½ï¼Œé€‰æ‹©äºŒè¿›åˆ¶è®¡æ•°
  52   1        P8254_CTL = initCode;   
  53   1        //å½“ä¸ºå·¥ä½œæ–¹å¼å³æ–¹å¼0æ—¶ï¼Œè®¡æ•°å€¼éœ€è¦å‡1
C51 COMPILER V9.59.0.0   82C54                                                             12/27/2018 21:24:49 PAGE 2   

  54   1        if(counterMode == INTERRUPT_MODE)     
  55   1        {
  56   2          countTime -= 1;
  57   2        }
  58   1        
  59   1        lowValue = (countTime & 0XFF);    //å–ä½å­—èŠ‚æ•°
  60   1        highValue = (countTime >> 8) & 0XFF;    //å–é«˜å­—èŠ‚æ•°
  61   1        switch(count_x)
  62   1        {
  63   2          case COUNT_0 :        //å¯¹åº”è®¡æ•°å™¨0
  64   2            P8254_0 = lowValue;
  65   2            P8254_0 = highValue;
  66   2            break;
  67   2          
  68   2          case COUNT_1 :        //å¯¹åº”è®¡æ•°å™¨1
  69   2            P8254_1= lowValue;
  70   2            P8254_1 = highValue;
  71   2            break;
  72   2          
  73   2          case COUNT_2 :        //å¯¹åº”è®¡æ•°å™¨2
  74   2            P8254_2= lowValue;
  75   2            P8254_2 = highValue;
  76   2            break;
  77   2          
  78   2          default:
  79   2            
  80   2          break;
  81   2        }
  82   1      }
  83          /** 
  84            * @brief  å®éªŒ1è¿›è¡Œledæµæ°´ç¯ å’Œè·‘é©¬ç¯åˆ‡æ¢
  85            * @param  void
  86            * @retval none
  87            */
  88          void EXInterruptLed(void)
  89          {
  90   1        static uint16_t timeDelay=0;
  91   1        static uint8_t rightShift=0x01;
  92   1        timeDelay++;
  93   1        if(gParam.c55LedMode==0)
  94   1        {
  95   2          if(timeDelay<=100)
  96   2          {
  97   3            P374=0xf0;
  98   3          }else if(timeDelay>100&&timeDelay<200)
  99   2          {
 100   3            P374=0x0f;
 101   3          }else
 102   2          {
 103   3            timeDelay=0;
 104   3          }
 105   2        }
 106   1        else if(gParam.c55LedMode==1)
 107   1        {
 108   2          
 109   2          if(timeDelay>=200)
 110   2          {
 111   3            timeDelay=0;
 112   3            rightShift=(rightShift<<1);
 113   3            if(rightShift==0)
 114   3            {
 115   4              rightShift=0x01;
C51 COMPILER V9.59.0.0   82C54                                                             12/27/2018 21:24:49 PAGE 3   

 116   4            }
 117   3            P374=~rightShift;
 118   3          }
 119   2        }
 120   1      }
 121          /** 
 122            * @brief  å¾—åˆ°å½“å‰ä¸¤ä¸ªè®¡æ•°å™¨çš„å€¼
 123            * @param  void
 124            * @retval none
 125            */
 126          void ShowCountTime(void)
 127          {
 128   1        uint32_t xdata countTime1=P8254_0;
 129   1        uint32_t xdata countTime2=P8254_1;
 130   1      
 131   1      }
 132          /*å®šä¹‰å¼€å…³è¾“å…¥å®å®šä¹‰*/
 133          #define KEY_VALUE (P1&0x03)
 134          /** 
 135            * @brief  å®éªŒ3ï¼Œåˆ¤æ–­ä¸Šä¸€æ¬¡å’Œè¿™ä¸€æ¬¡è¯»å‡ºæ¥å¼€å…³çš„å€¼ï¼Œè‹¥ç›¸åŒçš„è¯ï¼Œåˆ™ç›´æ¥è¿”å›ï
             -¼Œè‹¥ä¸åŒçš„è¯å¯¹82C54
 136          è¿›è¡Œé‡æ–°åˆå§‹åŒ–ï¼ŒåŒæ—¶è®°ä½è¿™ä¸€æ¬¡çš„å¼€å…³å€¼
 137            * @param  void
 138            * @retval none
 139            */
 140          void DiffFangBo(void)
 141          {
 142   1        static  xdata lastValue = 0;
 143   1        uint8_t key = KEY_VALUE;
 144   1        uint16_t xdata countTime1=P8254_0;
 145   1        
 146   1        if(lastValue==key)
 147   1        { 
 148   2          return;
 149   2        }
 150   1        
 151   1        if(KEY_VALUE==0)
 152   1        {
 153   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,10,BINARY_COUNT);
 154   2          HD7279ShowInt(200000);
 155   2        }
 156   1        else if(KEY_VALUE==1)
 157   1        {
 158   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,100,BINARY_COUNT);
 159   2          HD7279ShowInt(20000);
 160   2        }
 161   1        else if(KEY_VALUE==2)
 162   1        {
 163   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,1000,BINARY_COUNT);
 164   2          HD7279ShowInt(2000);
 165   2        }
 166   1        else if(KEY_VALUE==3)
 167   1        {
 168   2          Init_82C54(COUNT_0,SQUARE_WAVE_MODE,10000,BINARY_COUNT);
 169   2          HD7279ShowInt(200);
 170   2        }
 171   1        lastValue = key;
 172   1      }
 173          /** 
 174            * @brief  é€šè¿‡é¢„ç¼–è¯‘å®è¿›è¡Œä¸‹è½½
 175            * @param  void
 176            * @retval none
C51 COMPILER V9.59.0.0   82C54                                                             12/27/2018 21:24:49 PAGE 4   

 177            */
 178          void MyExperiment82C54(void)
 179          {
 180   1        #if C54_EXPERIMENT == C54_EXPERIMENT_1
 181   1           EXInterruptLed();
 182   1        #elif C54_EXPERIMENT == C54_EXPERIMENT_2
                   ShowCountTime();
                #elif C54_EXPERIMENT == C54_EXPERIMENT_3
                    DiffFangBo();
                #endif
 187   1      
 188   1      
 189   1      
 190   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    432    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5      12
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
