C51 COMPILER V9.59.0.0   TIMER                                                             11/17/2018 11:44:41 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE USERS\HardWare\timer.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USERS\HardW
                    -are;.\USERS) DEBUG OBJECTEXTEND PRINT(.\Listings\timer.lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          /****************************timer.c********************************/
   2          
   3          #include "timer.h"
   4          #include "STC15F2K60S2.h"
   5          #include "main.h"
   6          
   7          
   8          void TIM0_Init(uint16_t workMode,uint16_t timerStartValue)
   9          {
  10   1          uint8_t lowValue =  0;
  11   1          uint8_t highValue = 0;
  12   1          switch(workMode)
  13   1          {
  14   2            case THIRTEEN_BIT_COUNT:  
  15   2              TMOD |= workMode;
  16   2              /*最大计数值0x1FFF*/
  17   2              timerStartValue&=0x1FFF;
  18   2              
  19   2              lowValue=timerStartValue&0x1F;
  20   2              highValue=(timerStartValue>>5);
  21   2              TH0  = highValue;
  22   2              TL0  = lowValue;
  23   2              TR0=1;
  24   2            break;
  25   2            
  26   2            case SIXTEEN_BIT_COUNT:  
  27   2              TMOD |= workMode;
  28   2              lowValue=timerStartValue&0xFF;
  29   2              highValue=(timerStartValue>>8);
  30   2              TH0  = highValue;
  31   2              TL0  = lowValue;
  32   2              TR0=1;
  33   2            break;
  34   2            
  35   2            case EIGHT_BIT_AUTO_RELOUD_COUNT:  
  36   2              TMOD |= workMode;
  37   2              /*计数最大值*/
  38   2              timerStartValue&=0xFF;
  39   2            
  40   2              lowValue=timerStartValue;
  41   2              highValue=timerStartValue;
  42   2              TH0  = highValue;
  43   2              TL0  = lowValue;
  44   2              TR0=1;
  45   2            break;
  46   2            
  47   2            case TWO_EIGHT_BIT_COUNT:  
  48   2              TMOD |= workMode;
  49   2              TH0  = highValue;
  50   2              TL0  = lowValue;
  51   2              TR0=1;
  52   2            break;
  53   2            
  54   2            default:
C51 COMPILER V9.59.0.0   TIMER                                                             11/17/2018 11:44:41 PAGE 2   

  55   2            
  56   2            break;
  57   2          }
  58   1      }
  59          
  60          void TIM1_Init(uint16_t workMode,uint16_t timerStartValue)
  61          {
  62   1          uint8_t lowValue =  0;
  63   1          uint8_t highValue = 0;
  64   1          switch(workMode)
  65   1          {
  66   2            case THIRTEEN_BIT_COUNT:  
  67   2              TMOD |= (workMode<<4);
  68   2              /*最大计数值0x1FFF*/
  69   2              timerStartValue&=0x1FFF;
  70   2              
  71   2              lowValue=timerStartValue&0x1F;
  72   2              highValue=(timerStartValue>>5);
  73   2              TH1  = highValue;
  74   2              TL1  = lowValue;
  75   2              TR1=1;
  76   2            break;
  77   2            
  78   2            case SIXTEEN_BIT_COUNT:  
  79   2              TMOD |= (workMode<<4);
  80   2              lowValue=timerStartValue&0xFF;
  81   2              highValue=(timerStartValue>>8);
  82   2              TH1  = highValue;
  83   2              TL1  = lowValue;
  84   2              TR1=1;
  85   2            break;
  86   2            
  87   2            case EIGHT_BIT_AUTO_RELOUD_COUNT:  
  88   2              TMOD |= (workMode<<4);
  89   2              /*计数最大值*/
  90   2              timerStartValue&=0xFF;
  91   2              lowValue=timerStartValue;
  92   2              highValue=timerStartValue;
  93   2              TH1  = highValue;
  94   2              TL1  = lowValue;
  95   2              TR1=1;
  96   2            break;
  97   2            
  98   2            default:
  99   2            break;
 100   2            
 101   2          }
 102   1      }
 103          
 104          void Timer_Interrupt(uint8_t timer)
 105          {
 106   1        /*总开关中断*/
 107   1        EA=1;
 108   1        switch(timer)
 109   1        {
 110   2          case TIM0:
 111   2            ET0=1;
 112   2          break;
 113   2        
 114   2          case TIM1:
 115   2            ET1=1;
 116   2          break;
C51 COMPILER V9.59.0.0   TIMER                                                             11/17/2018 11:44:41 PAGE 3   

 117   2          
 118   2          default:
 119   2            
 120   2          break;
 121   2        }
 122   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    238    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
